(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{572:function(e,t,r){var content=r(579);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(18).default)("2dfb1a64",content,!0,{sourceMap:!1})},578:function(e,t,r){"use strict";r(572)},579:function(e,t,r){var n=r(17)(!1);n.push([e.i,'blockquote[data-v-2d605360]{background:#eee;border-radius:5px}blockquote p[data-v-2d605360]{padding:15px}blockquote p[data-v-2d605360]:before{content:"\\201C"}blockquote p[data-v-2d605360]:after{content:"\\201D"}cite[data-v-2d605360]{float:right;padding-right:50px}',""]),e.exports=n},600:function(e,t,r){"use strict";r.r(t);var n={props:{quote:{type:String,default:""},cite:{type:String,default:""}}},o=(r(578),r(83)),l={components:{BlockQuote:Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("blockquote",[r("p",[e._v(e._s(e.quote))])]),e._v(" "),e.cite?r("cite",[e._v("-- "+e._s(e.cite))]):e._e()])}),[],!1,null,"2d605360",null).exports}},v=r(177),d=r.n(v),c=r(612),_=r(549),m=r(547),h=r(543),f=Object(o.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-card",[r("v-card-title",{staticClass:"headline primary--text"},[e._v("Serveur HTTP")]),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Node.js et HTTP")]),e._v(" "),r("p",[e._v('\n            Node.js permet de créer "out-of-the-box" un serveur HTTP simple, grâce au module '),r("code",[e._v("http")]),e._v(" compris dans son coeur.\n\n            "),r("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[e._v("              "),r("code",{attrs:{language:"js"}},[e._v("\nimport { createServer } from 'http';\n\nhttp.createServer(function (req, res) {\n  res.write('Hello World!');\n  res.end();\n}).listen(8080);\n            ")])]),r("br"),e._v("\n            Le serveur ci-dessus :\n            "),r("ul",[r("li",[e._v("écoute sur le port 8080")]),e._v(" "),r("li",[e._v('renvoie la réponse "Hello World" aux requêtes entrantes')])]),e._v(" "),r("br"),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"info",icon:"info",outline:""}},[e._v("\n              Bien qu'il soit tout à fait possible d'utiliser uniquement "),r("code",[e._v("http")]),e._v(" pour créer des serveurs HTTP, la plupart des projets utilisent un framework comme "),r("a",{attrs:{href:"https://expressjs.com/fr/"}},[e._v("Express")]),e._v(", "),r("a",{attrs:{href:"https://hapijs.com/"}},[e._v("hapi")]),e._v(" ou "),r("a",{attrs:{href:"https://koajs.com/"}},[e._v("koa")]),e._v(".\n            ")])],1)],1),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"headline primary--text"},[e._v("Express")]),e._v(" "),r("BlockQuote",{attrs:{quote:"Express est une infrastructure d'applications Web Node.js minimaliste et flexible qui fournit un ensemble de fonctionnalités robuste pour les applications Web et mobiles.",cite:"https://expressjs.com/fr/"}}),e._v(" "),r("p",[e._v("\n            Concrètement, Express apporte les améliorations suivantes :\n            "),r("ul",[r("li",[e._v("Routage des URL par chemin et verbe HTTP")]),e._v(" "),r("li",[e._v("Parsage des paramètres d'entrée")]),e._v(" "),r("li",[e._v("Gestion des fichiers statiques")]),e._v(" "),r("li",[e._v("Templating HTML")])]),e._v(" "),r("br"),e._v("\n            Il est également possible d'ajouter des fonctionnalités grâce au mécanisme de "),r("code",[e._v("middleware")]),e._v("."),r("br"),e._v(" "),r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Anatomie du serveur")]),e._v(" "),r("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[r("code",{attrs:{language:"js"}},[e._v("\nimport express from 'express';\nconst app = express();\n\napp.get('/hello/:name', (req, res) => {\n  res.send(`Hello ${req.params.name}!`);\n});\n\napp.listen(3000, function () {\n  console.log('Example app listening on port 3000!');\n});\n            ")])]),r("br")],1),e._v(" "),r("p",[e._v("\n            Dans l'exemple ci-dessus, on définit la fonction qui sera executée lorsque le serveur une recevra une requête "),r("code",[e._v("GET")]),e._v(" avec une url de la forme "),r("code",[e._v("/hello/:name")]),e._v(" avec "),r("code",[e._v(":name")]),e._v(" qui est un paramètre qui peut-être récupéré dans la variable "),r("code",[e._v("req.params.name")]),e._v("."),r("br"),e._v("\n            Cette fonction est appelée "),r("code",[e._v("middleware")]),e._v(" et peut être définie de la manière suivante :\n            "),r("ul",[r("li",[e._v("si elle ne concerne qu'une méthode HTTP pour une URL donnée : on utilise "),r("a",{attrs:{href:"http://expressjs.com/en/4x/api.html#app.get.method"}},[e._v("app.get()")]),e._v(",  "),r("a",{attrs:{href:"http://expressjs.com/en/4x/api.html#app.post.method"}},[e._v("app.post()")]),e._v("...")]),e._v(" "),r("li",[e._v("sinon : on utilise "),r("a",{attrs:{href:"http://expressjs.com/en/4x/api.html#app.use.method"}},[e._v("app.use()")]),e._v(" qui permet de définir un middleware qui sera executé quelque soit la requête (ce qui est utile pour écrire des logs par exemple, compression de la réponse...).")])]),e._v(" "),r("strong",[e._v("A noter : les middlewares sont executés dans l'ordre dans lequel ils sont déclarés.")]),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"info",icon:"info",outline:""}},[e._v("\n              Il est possible d'utiliser des expressions régulières, des masques et / ou des gestionnaires de routage. Pour plus d'information se référer à la documentation officielle : "),r("a",{attrs:{href:"https://expressjs.com/fr/guide/routing.html"}},[e._v("Express routing")]),e._v(".\n            ")])],1)],1),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Ecrire un middleware")]),e._v(" "),r("p",[e._v("\n            Les paramètres d'une fonction "),r("code",[e._v("middleware")]),e._v(" sont :\n            "),r("ul",[r("li",[e._v("L'objet "),r("a",{attrs:{href:"http://expressjs.com/fr/4x/api.html#req"}},[e._v("Request")]),e._v(" "),r("code",[e._v("req")]),e._v(", qui encapsule l'objet "),r("a",{attrs:{href:"https://nodejs.org/api/http.html#http_class_http_incomingmessage"}},[e._v("IncomingMessage")]),e._v(" en ajoutant "),r("a",{attrs:{href:"http://expressjs.com/en/4x/api.html#req"}},[e._v("un ensemble de propriétés")]),e._v(" correspondant à la requête HTTP parsée comme : "),r("code",[e._v("baseUrl")]),e._v(", "),r("code",[e._v("path")]),e._v(", "),r("code",[e._v("body")]),e._v(", "),r("code",[e._v("params")]),e._v(" ou "),r("code",[e._v("method")]),e._v(" ;")]),e._v(" "),r("li",[e._v("L'objet "),r("a",{attrs:{href:"http://expressjs.com/fr/4x/api.html#res"}},[e._v("Response")]),e._v(" "),r("code",[e._v("res")]),e._v(" ;")]),e._v(" "),r("li",[r("code",[e._v("next")]),e._v(" qui est la fonction à appeler pour passer au middleware suivant dans le cycle de l'application")])]),e._v(" "),r("br"),e._v("\n            Par exemple :\n            "),r("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[r("code",{attrs:{language:"js"}},[e._v("\n(req, res, next) => { // Définition d'une fonction middleware\n  // Traitement\n  next(); // Appel du middleware suivant\n};\n            ")])]),r("br"),e._v("\n            Ainsi, un middleware doit (au choix) :\n            "),r("ul",[r("li",[e._v("Passer au middleware suivant en appelant "),r("code",[e._v("next()")]),e._v(" (après avoir modifié la requête "),r("code",[e._v("req")]),e._v(" et/ou la réponse "),r("code",[e._v("res")]),e._v(" par exemple);")]),e._v(" "),r("li",[e._v("Répondre immédiatement au client en appelant "),r("code",[e._v("res.send()")]),e._v(", ce qui stoppera le traitement de la requête et n'exécutera pas les middlewares suivants ;")]),e._v(" "),r("li",[e._v("Emettre une erreur en appelant "),r("code",[e._v("next()")]),e._v(" avec une erreur en paramètre, ce qui stoppera l'exécution des middlewares \"normaux\" et fera passer la requête dans les middlewares d'erreur (voir ci-dessous).")])])]),e._v(" "),r("p",[e._v("\n            Les middlewares d'erreur sont appelés dans le cas où une erreur est passé en premier paramètre du callback "),r("code",[e._v("next(err);")]),e._v(".\n            Par exemple :\n            "),r("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[r("code",{attrs:{language:"js"}},[e._v("\n(err, req, res, next) => { // Définition d'une fonction middleware d'erreur\n  res.status(500).send({ error: 'something blew up' });\n};\n            ")])]),r("br"),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"warning",icon:"warning",outline:""}},[e._v("\n              Le paramètre "),r("code",[e._v("next")]),e._v(" est obligatoire même s'il n'est pas utilisé. En effet, c'est le nombre de paramètres qui permet à Express de différencier les middlewares d'erreur.\n            ")]),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"info",icon:"info",outline:""}},[e._v("\n              Il existe de nombreux middleware out-of-the-box pour Express : "),r("a",{attrs:{href:"http://expressjs.com/en/resources/middleware.html"}},[e._v("Middlewares")]),e._v(".\n            ")])],1)],1),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"subheading secondary--text"},[e._v("TP Fil rouge")]),e._v(" "),r("p",[e._v("\n            Créer et tester un serveur HTTP avec Express qui :\n            "),r("ol",[r("li",[e._v("répond une erreur 404 sur un chemin qui n'existe pas ;")]),e._v(" "),r("li",[e._v("répond un statut 200 sur une requête "),r("code",[e._v("GET /browse/foo")]),e._v(" (avec "),r("code",[e._v("foo")]),e._v(" qui est un paramètre) et répond avec le contenu du dossier correspondant au paramètre du chemin (le nom, le type et la taille au format JSON), le dossier "),r("code",[e._v("foo")]),e._v(" étant à l'intérieur d'un répertoire "),r("code",[e._v("static")]),e._v(" présent à la racine du projet) ;")]),e._v(" "),r("li",[e._v("renvoie une erreur 404 si le dossier n'est pas trouvé (utiliser un middleware d'erreur) ;")]),e._v(" "),r("li",[e._v("loggue les requêtes / réponses du serveur (utiliser "),r("a",{attrs:{href:"https://www.npmjs.com/package/morgan"}},[e._v("morgan")]),e._v(") ;")]),e._v(" "),r("li",[e._v("répond au format HTML sur une requête "),r("code",[e._v("GET /browse/foo")]),e._v(" si le header "),r("code",[e._v("accept")]),e._v(" contient "),r("code",[e._v("html")]),e._v(" : pour cela, utiliser un moteur de template pour générer du HTML, c.f. "),r("a",{attrs:{href:"https://expressjs.com/en/guide/using-template-engines.html"}},[e._v("Express template engines")]),e._v(" (nous recommandons "),r("a",{attrs:{href:"https://www.npmjs.com/package/express-handlebars"}},[e._v("express-handlebars")]),e._v(").")])]),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"info",icon:"info",outline:""}},[e._v("\n              Il est possible d'obtenir des logs d'express pour debugguer plus facilement : "),r("a",{attrs:{href:"https://expressjs.com/fr/guide/debugging.html"}},[e._v("https://expressjs.com/fr/guide/debugging.html")]),e._v(".\n            ")]),e._v(" "),r("v-alert",{attrs:{outlined:"",value:!0,color:"warning",icon:"warning",outline:""}},[e._v("\n              Il faut bien traiter les questions dans l'ordre (tests compris) avant de passer à la question suivante.\n            ")])],1)],1)],1)],1)}),[],!1,null,null,null);t.default=f.exports;d()(f,{VAlert:c.a,VCard:_.a,VCardText:m.a,VCardTitle:m.b,VContainer:h.a})}}]);